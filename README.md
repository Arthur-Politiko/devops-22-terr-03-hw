# Домашнее задание к занятию «Управляющие конструкции в коде Terraform»

### Цели задания

------

### Задание 6* (необязательное)

1. Используя null_resource и local-exec, примените ansible-playbook к ВМ из ansible inventory-файла.
Готовый код возьмите из демонстрации к лекции [**demonstration2**](https://github.com/netology-code/ter-homeworks/tree/main/03/demo).
3. Модифицируйте файл-шаблон hosts.tftpl. Необходимо отредактировать переменную ```ansible_host="<внешний IP-address или внутренний IP-address если у ВМ отсутвует внешний адрес>```.

Для проверки работы уберите у ВМ внешние адреса(nat=false). Этот вариант используется при работе через bastion-сервер.
Для зачёта предоставьте код вместе с основной частью задания.

### Правила приёма работы

В своём git-репозитории создайте новую ветку terraform-03, закоммитьте в эту ветку свой финальный код проекта. Ответы на задания и необходимые скриншоты оформите в md-файле в ветке terraform-03.

В качестве результата прикрепите ссылку на ветку terraform-03 в вашем репозитории.

Важно. Удалите все созданные ресурсы.


------

# Решение


### Задание 6*

Из примера забрал описание Бастион (jump) сервера. Вот его описание. [bastion.tf](./src/bastion.tf)

Добавил переменную **bastion_enable** и в **personal.auto.tfvars** инициализирую её, заодно меняя значение уже использующейся **nat_enable** 

Из того что меня удивило, это необходимость прописывать **connection**, хотя в целом очевидно, ведь провиженер не знает о тех ключах которые мы передавали в провайдер.

Плюс ещё один момент, оказывается в шаблонах мы не видим переменные проекта, поэтому при формировании ``` inventory.ini ``` написал в шаблоне ``` hosts.tftpl  ``` условие просмотра флага **nat** из описания ВМ и выдачи соответствующего ip адреса. Не сложно, но при проектировании шаблонов это обязательно нужно учитывать.

Понравилось, что в целом для проекта очень простой конфиг для реализации бастион сервера.